{
  "openapi": "3.1.0",
  "info": {
    "title": "relational-rust-server",
    "description": "Custodial Avalanche wallet service running inside Intel SGX enclave with Gramine.",
    "contact": {
      "name": "Relational Network"
    },
    "license": {
      "name": "AGPL-3.0-or-later",
      "identifier": "AGPL-3.0-or-later"
    },
    "version": "0.1.0"
  },
  "paths": {
    "/health": {
      "get": {
        "tags": [
          "Health"
        ],
        "summary": "Health check endpoint handler.",
        "description": "Returns 200 if all checks pass, 503 if any check fails.",
        "operationId": "health",
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReadyResponse"
                }
              }
            }
          },
          "503": {
            "description": "Service is unhealthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReadyResponse"
                }
              }
            }
          }
        }
      }
    },
    "/health/live": {
      "get": {
        "tags": [
          "Health"
        ],
        "summary": "Liveness probe handler.",
        "description": "Always returns 200 if the process is running.\nDoes not check dependencies - use readiness for that.",
        "operationId": "liveness",
        "responses": {
          "200": {
            "description": "Service is alive",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/health/ready": {
      "get": {
        "tags": [
          "Health"
        ],
        "summary": "Readiness probe handler.",
        "description": "Returns 200 only if all dependencies are available.\nUse for Kubernetes readiness probes.",
        "operationId": "readiness",
        "responses": {
          "200": {
            "description": "Service is ready",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReadyResponse"
                }
              }
            }
          },
          "503": {
            "description": "Service is not ready",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReadyResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/admin/audit/events": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Query audit logs.",
        "description": "Search and filter audit log entries. Supports date range, user ID,\nevent type, and resource filtering. Admin only.",
        "operationId": "query_audit_logs",
        "parameters": [
          {
            "name": "start_date",
            "in": "query",
            "description": "Start date (YYYY-MM-DD format).",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          {
            "name": "end_date",
            "in": "query",
            "description": "End date (YYYY-MM-DD format).",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          {
            "name": "user_id",
            "in": "query",
            "description": "Filter by user ID.",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          {
            "name": "event_type",
            "in": "query",
            "description": "Filter by event type.",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          {
            "name": "resource_type",
            "in": "query",
            "description": "Filter by resource type.",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          {
            "name": "resource_id",
            "in": "query",
            "description": "Filter by resource ID.",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results (default 100).",
            "required": false,
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "minimum": 0
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Offset for pagination.",
            "required": false,
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "minimum": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Audit events",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuditLogResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid query parameters"
          },
          "401": {
            "description": "Not authenticated"
          },
          "403": {
            "description": "Not authorized (admin required)"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/admin/health": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Get detailed health information.",
        "description": "Returns comprehensive health status including storage metrics.\nMore detailed than the public health endpoint. Admin only.",
        "operationId": "get_detailed_health",
        "responses": {
          "200": {
            "description": "Detailed health status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DetailedHealthResponse"
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated"
          },
          "403": {
            "description": "Not authorized (admin required)"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/admin/stats": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Get system statistics.",
        "description": "Returns aggregate statistics about the system including wallet counts,\ninvite usage, and storage metrics. Admin only.",
        "operationId": "get_system_stats",
        "responses": {
          "200": {
            "description": "System statistics",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SystemStatsResponse"
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated"
          },
          "403": {
            "description": "Not authorized (admin required)"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/admin/users": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List all unique users with their resource counts.",
        "description": "Returns a summary of all users who have wallets, bookmarks, or recurring payments.",
        "operationId": "list_all_users",
        "responses": {
          "200": {
            "description": "User summaries",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUserListResponse"
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated"
          },
          "403": {
            "description": "Not authorized (admin required)"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/admin/wallets": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List all wallets (admin view).",
        "description": "Returns all wallets across all users. Admin only.",
        "operationId": "list_all_wallets",
        "responses": {
          "200": {
            "description": "All wallets",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminWalletListResponse"
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated"
          },
          "403": {
            "description": "Not authorized (admin required)"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/admin/wallets/{wallet_id}/activate": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Reactivate a suspended wallet (admin action).",
        "description": "Reactivates a previously suspended wallet.",
        "operationId": "activate_wallet",
        "parameters": [
          {
            "name": "wallet_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Wallet activated"
          },
          "401": {
            "description": "Not authenticated"
          },
          "403": {
            "description": "Not authorized (admin required)"
          },
          "404": {
            "description": "Wallet not found"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/admin/wallets/{wallet_id}/suspend": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Suspend a wallet (admin action).",
        "description": "Suspends a wallet by ID. The wallet owner cannot perform operations\non suspended wallets until reactivated.",
        "operationId": "suspend_wallet",
        "parameters": [
          {
            "name": "wallet_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Wallet suspended"
          },
          "401": {
            "description": "Not authenticated"
          },
          "403": {
            "description": "Not authorized (admin required)"
          },
          "404": {
            "description": "Wallet not found"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/bookmarks": {
      "get": {
        "tags": [
          "Bookmarks"
        ],
        "summary": "List bookmarks for a wallet.",
        "description": "Returns all bookmarks for a wallet owned by the authenticated user.",
        "operationId": "list_bookmarks",
        "parameters": [
          {
            "name": "wallet_id",
            "in": "query",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/WalletAddress"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Bookmark"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not your wallet"
          },
          "404": {
            "description": "Wallet not found"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      },
      "post": {
        "tags": [
          "Bookmarks"
        ],
        "summary": "Create a new bookmark.",
        "description": "Creates a bookmark in a wallet owned by the authenticated user.",
        "operationId": "create_bookmark",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateBookmarkRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Bookmark"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not your wallet"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/bookmarks/{bookmark_id}": {
      "delete": {
        "tags": [
          "Bookmarks"
        ],
        "summary": "Delete a bookmark.",
        "description": "Deletes a bookmark owned by the authenticated user.",
        "operationId": "delete_bookmark",
        "parameters": [
          {
            "name": "bookmark_id",
            "in": "path",
            "description": "Identifier of the bookmark to delete",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Bookmark deleted"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not your bookmark"
          },
          "404": {
            "description": "Bookmark not found"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/invite": {
      "get": {
        "tags": [
          "Invites"
        ],
        "operationId": "get_invite",
        "parameters": [
          {
            "name": "invite_code",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Invite"
                }
              }
            }
          }
        }
      }
    },
    "/v1/invite/redeem": {
      "post": {
        "tags": [
          "Invites"
        ],
        "operationId": "redeem_invite",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RedeemInviteRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": ""
          }
        }
      }
    },
    "/v1/recurring/payment": {
      "post": {
        "tags": [
          "Recurring"
        ],
        "operationId": "create_recurring_payment",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateRecurringPaymentRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": ""
          }
        }
      }
    },
    "/v1/recurring/payment/{recurring_payment_id}": {
      "put": {
        "tags": [
          "Recurring"
        ],
        "operationId": "update_recurring_payment",
        "parameters": [
          {
            "name": "recurring_payment_id",
            "in": "path",
            "description": "Identifier of the recurring payment to update",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateRecurringPaymentRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": ""
          }
        }
      },
      "delete": {
        "tags": [
          "Recurring"
        ],
        "operationId": "delete_recurring_payment",
        "parameters": [
          {
            "name": "recurring_payment_id",
            "in": "path",
            "description": "Identifier of the recurring payment to delete",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": ""
          }
        }
      }
    },
    "/v1/recurring/payment/{recurring_payment_id}/last-paid-date": {
      "put": {
        "tags": [
          "Recurring"
        ],
        "operationId": "update_last_paid_date",
        "parameters": [
          {
            "name": "recurring_payment_id",
            "in": "path",
            "description": "Identifier of the recurring payment to update",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateLastPaidDateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": ""
          }
        }
      }
    },
    "/v1/recurring/payments": {
      "get": {
        "tags": [
          "Recurring"
        ],
        "operationId": "list_recurring_payments",
        "parameters": [
          {
            "name": "wallet_id",
            "in": "query",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/WalletAddress"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RecurringPayment"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/recurring/payments/today": {
      "get": {
        "tags": [
          "Recurring"
        ],
        "operationId": "recurring_payments_today",
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RecurringPayment"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/users/me": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Get the current authenticated user's information.",
        "description": "This endpoint returns the identity and roles of the currently authenticated user.",
        "operationId": "get_current_user",
        "responses": {
          "200": {
            "description": "User information",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserMeResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    },
    "/v1/wallet/autofund": {
      "post": {
        "tags": [
          "Wallet"
        ],
        "operationId": "autofund_wallet",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AutofundRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": ""
          }
        }
      }
    },
    "/v1/wallets": {
      "get": {
        "tags": [
          "Wallets"
        ],
        "summary": "List all wallets owned by the authenticated user.",
        "operationId": "list_wallets",
        "responses": {
          "200": {
            "description": "List of wallets",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WalletListResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      },
      "post": {
        "tags": [
          "Wallets"
        ],
        "summary": "Create a new wallet for the authenticated user.",
        "description": "Generates a new p256 keypair inside the SGX enclave and stores it\nencrypted on disk. Returns the wallet metadata (never the private key).",
        "operationId": "create_wallet",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateWalletRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Wallet created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateWalletResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "500": {
            "description": "Internal server error"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/wallets/{wallet_id}": {
      "get": {
        "tags": [
          "Wallets"
        ],
        "summary": "Get a specific wallet by ID.",
        "description": "Only returns wallets owned by the authenticated user.",
        "operationId": "get_wallet",
        "parameters": [
          {
            "name": "wallet_id",
            "in": "path",
            "description": "Wallet ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Wallet details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WalletResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not your wallet"
          },
          "404": {
            "description": "Wallet not found"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      },
      "delete": {
        "tags": [
          "Wallets"
        ],
        "summary": "Delete (soft-delete) a wallet.",
        "description": "Marks the wallet as deleted. The private key is retained for potential\nrecovery but the wallet cannot be used for new transactions.",
        "operationId": "delete_wallet",
        "parameters": [
          {
            "name": "wallet_id",
            "in": "path",
            "description": "Wallet ID to delete",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Wallet deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeleteWalletResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not your wallet"
          },
          "404": {
            "description": "Wallet not found"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/v1/wallets/{wallet_id}/balance": {
      "get": {
        "tags": [
          "Wallets"
        ],
        "summary": "Get the balance of a wallet on the Avalanche C-Chain.",
        "description": "Returns native AVAX balance and any configured ERC-20 token balances.",
        "operationId": "get_wallet_balance",
        "parameters": [
          {
            "name": "wallet_id",
            "in": "path",
            "description": "Wallet ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "network",
            "in": "query",
            "description": "Network to query: \"fuji\" (testnet) or \"mainnet\"",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ],
              "default": "fuji"
            }
          },
          {
            "name": "tokens",
            "in": "query",
            "description": "Additional token contract addresses to query (comma-separated)",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Balance retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BalanceResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not wallet owner"
          },
          "404": {
            "description": "Wallet not found"
          },
          "503": {
            "description": "Blockchain network unavailable"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    },
    "/v1/wallets/{wallet_id}/balance/native": {
      "get": {
        "tags": [
          "Wallets"
        ],
        "summary": "Get only the native AVAX balance of a wallet (faster).",
        "operationId": "get_native_balance",
        "parameters": [
          {
            "name": "wallet_id",
            "in": "path",
            "description": "Wallet ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "network",
            "in": "query",
            "description": "Network to query: \"fuji\" (testnet) or \"mainnet\"",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ],
              "default": "fuji"
            }
          },
          {
            "name": "tokens",
            "in": "query",
            "description": "Additional token contract addresses to query (comma-separated)",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Native balance retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NativeBalanceResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not wallet owner"
          },
          "404": {
            "description": "Wallet not found"
          },
          "503": {
            "description": "Blockchain network unavailable"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "AdminUserListResponse": {
        "type": "object",
        "description": "Response for admin user list.",
        "required": [
          "users",
          "total"
        ],
        "properties": {
          "total": {
            "type": "integer",
            "description": "Total unique users.",
            "minimum": 0
          },
          "users": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AdminUserSummary"
            },
            "description": "User summaries."
          }
        }
      },
      "AdminUserSummary": {
        "type": "object",
        "description": "Admin user summary.",
        "required": [
          "user_id",
          "wallet_count",
          "bookmark_count",
          "recurring_payment_count"
        ],
        "properties": {
          "bookmark_count": {
            "type": "integer",
            "description": "Number of bookmarks.",
            "minimum": 0
          },
          "recurring_payment_count": {
            "type": "integer",
            "description": "Number of recurring payments.",
            "minimum": 0
          },
          "user_id": {
            "type": "string",
            "description": "User ID from Clerk."
          },
          "wallet_count": {
            "type": "integer",
            "description": "Number of wallets owned.",
            "minimum": 0
          }
        }
      },
      "AdminWalletItem": {
        "type": "object",
        "description": "Admin wallet list item (shows all wallets regardless of owner).",
        "required": [
          "wallet_id",
          "owner_user_id",
          "public_address",
          "status",
          "created_at"
        ],
        "properties": {
          "created_at": {
            "type": "string",
            "description": "When the wallet was created."
          },
          "owner_user_id": {
            "type": "string",
            "description": "Owner's user ID."
          },
          "public_address": {
            "type": "string",
            "description": "Public address."
          },
          "status": {
            "$ref": "#/components/schemas/WalletStatus",
            "description": "Wallet status."
          },
          "wallet_id": {
            "type": "string",
            "description": "Wallet unique identifier."
          }
        }
      },
      "AdminWalletListResponse": {
        "type": "object",
        "description": "Response for admin wallet list.",
        "required": [
          "wallets",
          "total"
        ],
        "properties": {
          "total": {
            "type": "integer",
            "description": "Total count.",
            "minimum": 0
          },
          "wallets": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AdminWalletItem"
            },
            "description": "List of all wallets."
          }
        }
      },
      "AuditEvent": {
        "type": "object",
        "description": "An audit log entry.",
        "required": [
          "event_id",
          "timestamp",
          "event_type",
          "success"
        ],
        "properties": {
          "details": {
            "type": [
              "object",
              "null"
            ],
            "description": "Additional details as JSON."
          },
          "error": {
            "type": [
              "string",
              "null"
            ],
            "description": "Error message if operation failed."
          },
          "event_id": {
            "type": "string",
            "description": "Unique event ID."
          },
          "event_type": {
            "$ref": "#/components/schemas/AuditEventType",
            "description": "Type of event."
          },
          "ip_address": {
            "type": [
              "string",
              "null"
            ],
            "description": "IP address of the request (if available)."
          },
          "resource_id": {
            "type": [
              "string",
              "null"
            ],
            "description": "Resource affected (wallet_id, bookmark_id, etc.)."
          },
          "resource_type": {
            "type": [
              "string",
              "null"
            ],
            "description": "Resource type (wallet, bookmark, etc.)."
          },
          "success": {
            "type": "boolean",
            "description": "Whether the operation succeeded."
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When the event occurred."
          },
          "user_id": {
            "type": [
              "string",
              "null"
            ],
            "description": "User who triggered the event (if known)."
          }
        }
      },
      "AuditEventType": {
        "type": "string",
        "description": "Types of auditable events.",
        "enum": [
          "wallet_created",
          "wallet_deleted",
          "wallet_accessed",
          "transaction_signed",
          "transaction_broadcast",
          "bookmark_created",
          "bookmark_deleted",
          "invite_created",
          "invite_redeemed",
          "recurring_created",
          "recurring_updated",
          "recurring_deleted",
          "recurring_executed",
          "auth_success",
          "auth_failure",
          "permission_denied",
          "admin_access",
          "config_changed"
        ]
      },
      "AuditLogResponse": {
        "type": "object",
        "description": "Response for audit log queries.",
        "required": [
          "events",
          "total",
          "has_more"
        ],
        "properties": {
          "events": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AuditEvent"
            },
            "description": "Audit events matching the query."
          },
          "has_more": {
            "type": "boolean",
            "description": "Whether there are more results."
          },
          "total": {
            "type": "integer",
            "description": "Total count (before limit/offset).",
            "minimum": 0
          }
        }
      },
      "AutofundRequest": {
        "type": "object",
        "required": [
          "wallet_id"
        ],
        "properties": {
          "wallet_id": {
            "$ref": "#/components/schemas/WalletAddress"
          }
        }
      },
      "BalanceResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/WalletBalanceResponse",
            "description": "Balance information"
          },
          {
            "type": "object",
            "required": [
              "wallet_id"
            ],
            "properties": {
              "wallet_id": {
                "type": "string",
                "description": "Wallet ID"
              }
            }
          }
        ],
        "description": "Balance response."
      },
      "Bookmark": {
        "type": "object",
        "required": [
          "id",
          "wallet_id",
          "name",
          "address"
        ],
        "properties": {
          "address": {
            "$ref": "#/components/schemas/WalletAddress"
          },
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "wallet_id": {
            "$ref": "#/components/schemas/WalletAddress"
          }
        }
      },
      "CreateBookmarkRequest": {
        "type": "object",
        "required": [
          "wallet_id",
          "name",
          "address"
        ],
        "properties": {
          "address": {
            "$ref": "#/components/schemas/WalletAddress"
          },
          "name": {
            "type": "string"
          },
          "wallet_id": {
            "$ref": "#/components/schemas/WalletAddress"
          }
        }
      },
      "CreateRecurringPaymentRequest": {
        "type": "object",
        "required": [
          "wallet_id",
          "wallet_public_key",
          "recipient",
          "amount",
          "currency_code",
          "payment_start_date",
          "frequency",
          "payment_end_date"
        ],
        "properties": {
          "amount": {
            "type": "number",
            "format": "double"
          },
          "currency_code": {
            "type": "string"
          },
          "frequency": {
            "type": "integer",
            "format": "int32"
          },
          "payment_end_date": {
            "type": "integer",
            "format": "int32"
          },
          "payment_start_date": {
            "type": "integer",
            "format": "int32"
          },
          "recipient": {
            "$ref": "#/components/schemas/WalletAddress"
          },
          "wallet_id": {
            "$ref": "#/components/schemas/WalletAddress"
          },
          "wallet_public_key": {
            "type": "string"
          }
        }
      },
      "CreateWalletRequest": {
        "type": "object",
        "description": "Request to create a new wallet.",
        "properties": {
          "label": {
            "type": [
              "string",
              "null"
            ],
            "description": "Optional human-readable label for the wallet."
          }
        }
      },
      "CreateWalletResponse": {
        "type": "object",
        "description": "Response after creating a wallet.",
        "required": [
          "wallet",
          "message"
        ],
        "properties": {
          "message": {
            "type": "string",
            "description": "Message indicating success."
          },
          "wallet": {
            "$ref": "#/components/schemas/WalletResponse",
            "description": "The created wallet details."
          }
        }
      },
      "DeleteWalletResponse": {
        "type": "object",
        "description": "Response after deleting a wallet.",
        "required": [
          "message",
          "wallet_id"
        ],
        "properties": {
          "message": {
            "type": "string",
            "description": "Message indicating success."
          },
          "wallet_id": {
            "type": "string",
            "description": "The ID of the deleted wallet."
          }
        }
      },
      "DetailedHealthResponse": {
        "type": "object",
        "description": "Detailed health check response for admins.",
        "required": [
          "status",
          "storage",
          "auth_configured",
          "version",
          "build_time"
        ],
        "properties": {
          "auth_configured": {
            "type": "boolean",
            "description": "Auth configuration status."
          },
          "build_time": {
            "type": "string",
            "description": "Build timestamp."
          },
          "status": {
            "type": "string",
            "description": "Overall status."
          },
          "storage": {
            "$ref": "#/components/schemas/StorageHealth",
            "description": "Storage health."
          },
          "version": {
            "type": "string",
            "description": "Server version."
          }
        }
      },
      "HealthChecks": {
        "type": "object",
        "description": "Individual health check results.",
        "required": [
          "service"
        ],
        "properties": {
          "data_dir": {
            "type": [
              "string",
              "null"
            ],
            "description": "Data directory availability (if configured)."
          },
          "jwks": {
            "type": [
              "string",
              "null"
            ],
            "description": "JWKS (authentication keys) status.\nOnly present in production mode (CLERK_JWKS_URL configured)."
          },
          "service": {
            "type": "string",
            "description": "Whether the service process is running."
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "description": "Simple health check response for liveness probes.",
        "required": [
          "status"
        ],
        "properties": {
          "status": {
            "type": "string"
          }
        }
      },
      "Invite": {
        "type": "object",
        "required": [
          "id",
          "code",
          "redeemed"
        ],
        "properties": {
          "code": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "redeemed": {
            "type": "boolean"
          }
        }
      },
      "NativeBalanceResponse": {
        "type": "object",
        "description": "Native token balance response (simpler version).",
        "required": [
          "wallet_id",
          "address",
          "network",
          "balance_wei",
          "balance"
        ],
        "properties": {
          "address": {
            "type": "string",
            "description": "Public address"
          },
          "balance": {
            "type": "string",
            "description": "AVAX balance formatted"
          },
          "balance_wei": {
            "type": "string",
            "description": "AVAX balance in wei"
          },
          "network": {
            "type": "string",
            "description": "Network name"
          },
          "wallet_id": {
            "type": "string",
            "description": "Wallet ID"
          }
        }
      },
      "ReadyResponse": {
        "type": "object",
        "description": "Health check response with individual component status.",
        "required": [
          "status",
          "checks"
        ],
        "properties": {
          "checks": {
            "$ref": "#/components/schemas/HealthChecks",
            "description": "Individual health checks and their results."
          },
          "status": {
            "type": "string",
            "description": "Overall health status (\"ok\" or \"degraded\")."
          }
        }
      },
      "RecurringPayment": {
        "type": "object",
        "required": [
          "id",
          "wallet_id",
          "wallet_public_key",
          "recipient",
          "amount",
          "currency_code",
          "payment_start_date",
          "frequency",
          "payment_end_date",
          "last_paid_date"
        ],
        "properties": {
          "amount": {
            "type": "number",
            "format": "double"
          },
          "currency_code": {
            "type": "string"
          },
          "frequency": {
            "type": "integer",
            "format": "int32"
          },
          "id": {
            "type": "string"
          },
          "last_paid_date": {
            "type": "integer",
            "format": "int32"
          },
          "payment_end_date": {
            "type": "integer",
            "format": "int32"
          },
          "payment_start_date": {
            "type": "integer",
            "format": "int32"
          },
          "recipient": {
            "$ref": "#/components/schemas/WalletAddress"
          },
          "wallet_id": {
            "$ref": "#/components/schemas/WalletAddress"
          },
          "wallet_public_key": {
            "type": "string"
          }
        }
      },
      "RedeemInviteRequest": {
        "type": "object",
        "required": [
          "invite_id"
        ],
        "properties": {
          "invite_id": {
            "type": "string"
          }
        }
      },
      "Role": {
        "type": "string",
        "description": "User roles for authorization.\n\n## Role Hierarchy\n\n- `Admin` - Full access to all endpoints and wallets\n- `Client` - Normal user, can only access own wallets\n- `Support` - Read-only access to metadata (no private keys)\n- `Auditor` - Read-only access to audit logs",
        "enum": [
          "admin",
          "client",
          "support",
          "auditor"
        ]
      },
      "StorageHealth": {
        "type": "object",
        "description": "Storage health details.",
        "required": [
          "data_dir",
          "exists",
          "writable",
          "total_files"
        ],
        "properties": {
          "data_dir": {
            "type": "string",
            "description": "Data directory path."
          },
          "exists": {
            "type": "boolean",
            "description": "Whether the data directory exists."
          },
          "total_files": {
            "type": "integer",
            "description": "Total files in storage (approximate).",
            "minimum": 0
          },
          "writable": {
            "type": "boolean",
            "description": "Whether the data directory is writable."
          }
        }
      },
      "SystemStatsResponse": {
        "type": "object",
        "description": "System statistics response.",
        "required": [
          "total_wallets",
          "active_wallets",
          "suspended_wallets",
          "deleted_wallets",
          "total_bookmarks",
          "total_invites",
          "redeemed_invites",
          "total_recurring_payments",
          "uptime_seconds",
          "timestamp"
        ],
        "properties": {
          "active_wallets": {
            "type": "integer",
            "description": "Number of active wallets.",
            "minimum": 0
          },
          "deleted_wallets": {
            "type": "integer",
            "description": "Number of deleted wallets.",
            "minimum": 0
          },
          "redeemed_invites": {
            "type": "integer",
            "description": "Number of redeemed invites.",
            "minimum": 0
          },
          "suspended_wallets": {
            "type": "integer",
            "description": "Number of suspended wallets.",
            "minimum": 0
          },
          "timestamp": {
            "type": "string",
            "description": "Current timestamp."
          },
          "total_bookmarks": {
            "type": "integer",
            "description": "Total number of bookmarks.",
            "minimum": 0
          },
          "total_invites": {
            "type": "integer",
            "description": "Total number of invites.",
            "minimum": 0
          },
          "total_recurring_payments": {
            "type": "integer",
            "description": "Total number of recurring payments.",
            "minimum": 0
          },
          "total_wallets": {
            "type": "integer",
            "description": "Total number of wallets across all users.",
            "minimum": 0
          },
          "uptime_seconds": {
            "type": "integer",
            "format": "int64",
            "description": "Server uptime information.",
            "minimum": 0
          }
        }
      },
      "TokenBalance": {
        "type": "object",
        "description": "Token balance information.",
        "required": [
          "symbol",
          "name",
          "balance_raw",
          "balance_formatted",
          "decimals"
        ],
        "properties": {
          "balance_formatted": {
            "type": "string",
            "description": "Balance formatted with decimals"
          },
          "balance_raw": {
            "type": "string",
            "description": "Balance in smallest unit (wei for native, token decimals for ERC-20)"
          },
          "contract_address": {
            "type": [
              "string",
              "null"
            ],
            "description": "Contract address (None for native token)"
          },
          "decimals": {
            "type": "integer",
            "format": "int32",
            "description": "Number of decimals",
            "minimum": 0
          },
          "name": {
            "type": "string",
            "description": "Token name"
          },
          "symbol": {
            "type": "string",
            "description": "Token symbol (e.g., \"AVAX\", \"EUROC\")"
          }
        }
      },
      "UpdateLastPaidDateRequest": {
        "type": "object",
        "required": [
          "recurring_payment_id",
          "last_paid_date"
        ],
        "properties": {
          "last_paid_date": {
            "type": "integer",
            "format": "int32"
          },
          "recurring_payment_id": {
            "type": "string"
          }
        }
      },
      "UpdateRecurringPaymentRequest": {
        "type": "object",
        "required": [
          "recurring_payment_id",
          "wallet_id",
          "wallet_public_key",
          "recipient",
          "amount",
          "currency_code",
          "payment_start_date",
          "frequency",
          "payment_end_date"
        ],
        "properties": {
          "amount": {
            "type": "number",
            "format": "double"
          },
          "currency_code": {
            "type": "string"
          },
          "frequency": {
            "type": "integer",
            "format": "int32"
          },
          "payment_end_date": {
            "type": "integer",
            "format": "int32"
          },
          "payment_start_date": {
            "type": "integer",
            "format": "int32"
          },
          "recipient": {
            "$ref": "#/components/schemas/WalletAddress"
          },
          "recurring_payment_id": {
            "type": "string"
          },
          "wallet_id": {
            "$ref": "#/components/schemas/WalletAddress"
          },
          "wallet_public_key": {
            "type": "string"
          }
        }
      },
      "UserMeResponse": {
        "type": "object",
        "description": "Response for GET /v1/users/me",
        "required": [
          "user_id",
          "role"
        ],
        "properties": {
          "role": {
            "$ref": "#/components/schemas/Role",
            "description": "User's role"
          },
          "session_id": {
            "type": [
              "string",
              "null"
            ],
            "description": "Session ID (if available)"
          },
          "user_id": {
            "type": "string",
            "description": "User's unique ID (from Clerk)"
          }
        }
      },
      "WalletAddress": {
        "type": "string"
      },
      "WalletBalanceResponse": {
        "type": "object",
        "description": "Wallet balance response including native and token balances.",
        "required": [
          "address",
          "network",
          "chain_id",
          "native_balance",
          "token_balances"
        ],
        "properties": {
          "address": {
            "type": "string",
            "description": "Wallet address"
          },
          "chain_id": {
            "type": "integer",
            "format": "int64",
            "description": "Chain ID",
            "minimum": 0
          },
          "native_balance": {
            "$ref": "#/components/schemas/TokenBalance",
            "description": "Native token balance (AVAX)"
          },
          "network": {
            "type": "string",
            "description": "Network name"
          },
          "token_balances": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TokenBalance"
            },
            "description": "ERC-20 token balances"
          }
        }
      },
      "WalletListResponse": {
        "type": "object",
        "description": "Response containing a list of wallets.",
        "required": [
          "wallets",
          "total"
        ],
        "properties": {
          "total": {
            "type": "integer",
            "description": "Total count of wallets.",
            "minimum": 0
          },
          "wallets": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/WalletResponse"
            },
            "description": "List of wallets owned by the user."
          }
        }
      },
      "WalletResponse": {
        "type": "object",
        "description": "Response returned to API clients (never includes private key).",
        "required": [
          "wallet_id",
          "public_address",
          "created_at",
          "status"
        ],
        "properties": {
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the wallet was created"
          },
          "label": {
            "type": [
              "string",
              "null"
            ],
            "description": "Optional human-readable label"
          },
          "public_address": {
            "type": "string",
            "description": "Public address"
          },
          "status": {
            "$ref": "#/components/schemas/WalletStatus",
            "description": "Current wallet status"
          },
          "wallet_id": {
            "type": "string",
            "description": "Unique wallet identifier"
          }
        }
      },
      "WalletStatus": {
        "type": "string",
        "description": "Wallet status.",
        "enum": [
          "active",
          "suspended",
          "deleted"
        ]
      }
    },
    "securitySchemes": {
      "bearer": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Clerk JWT token"
      }
    }
  },
  "tags": [
    {
      "name": "Users",
      "description": "User identity and authentication"
    },
    {
      "name": "Wallets",
      "description": "Wallet lifecycle management"
    },
    {
      "name": "Bookmarks",
      "description": "Bookmark management"
    },
    {
      "name": "Invites",
      "description": "Invite validation and redemption"
    },
    {
      "name": "Wallet",
      "description": "Wallet utilities (legacy)"
    },
    {
      "name": "Recurring",
      "description": "Recurring payment scheduling"
    },
    {
      "name": "Admin",
      "description": "Admin-only system management"
    },
    {
      "name": "Health",
      "description": "Liveness and readiness checks"
    }
  ]
}